services:

  pgdb:
    container_name: pgdb
    image: postgres:16
    env_file:
      - .env
    volumes:
      - ./postgres_data:/var/lib/postgresql/data
      - ./initdb:/docker-entrypoint-initdb.d:ro
    
  mongodb:
    image: mongo:6.0
    environment:
      MONGO_INITDB_DATABASE: librechat
    volumes:
      - ./mongo_data:/data/db
 

  litellm:
    image: ghcr.io/berriai/litellm:main-latest
    container_name: litellm
    ports:
      - "5002:4000"
    env_file:
      - .env
    volumes:
      - ./litellm/config.yaml:/app/config.yaml
    command: ["--port", "4000", "--config", "/app/config.yaml"]

  keycloak:
    image: quay.io/keycloak/keycloak
    container_name: keycloak
    command:
      - start-dev
      - --import-realm
    env_file:
     - .env
    ports:
      - "4000:8080"
    restart: unless-stopped
    volumes:
      - ./keycloak/realm-librechat.json:/opt/keycloak/data/import/realm-librechat.json:ro
      - ./keycloak/providers:/opt/keycloak/providers

  librechat:
    #image: ghcr.io/danny-avila/librechat:latest
    build:
      context: .
      dockerfile: Dockerfile.librechat
    container_name: librechat
    env_file:
      - .env
    ports:
      - "3000:3000"
    volumes:
      - type: bind
        source: ./librechat/librechat.yaml
        target: /app/librechat.yaml

    extra_hosts:
      - "localhost:host-gateway"
